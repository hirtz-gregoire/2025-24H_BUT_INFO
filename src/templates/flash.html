<div class="fixed top-4 right-4 z-50 space-y-2">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="
          flash-message
          flex flex-col items-start justify-between gap-2
          p-4 rounded border max-w-md w-full text-base relative
          {% if category == 'success' %}
            bg-green-100 text-green-800 border-green-300
          {% elif category == 'error' %}
            bg-red-100 text-red-800 border-red-300
          {% elif category == 'warning' %}
            bg-yellow-100 text-yellow-800 border-yellow-300
          {% else %}
            bg-gray-100 text-gray-800 border-gray-300
          {% endif %}
        ">
          <div class="flex w-full items-center justify-between">
            <span class="flex-1">{{ message }}</span>
            <button class="close-flash ml-2 text-gray-500 hover:text-gray-700 focus:outline-none" aria-label="Fermer">
              <img src="{{ url_for('static', filename='icone/close.svg') }}" alt="Fermer" class="h-8 w-8">
            </button>
          </div>
          <div class="progress-container w-full h-1 bg-gray-200 rounded-full mt-2">
            <div class="progress-bar h-full rounded-full 
              {% if category == 'success' %}
                bg-green-500
              {% elif category == 'error' %}
                bg-red-500
              {% elif category == 'warning' %}
                bg-yellow-500
              {% else %}
                bg-gray-500
              {% endif %}
            " style="width: 100%;"></div>
          </div>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const flashMessages = document.querySelectorAll('.flash-message');
    const displayDuration = 3000;
    
    // Fonction pour fermer un message flash
    function closeFlashMessage(message) {
      message.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
      message.style.opacity = '0';
      message.style.transform = 'translateX(10px)';
      
      setTimeout(() => {
        message.remove();
      }, 500);
    }
    
    flashMessages.forEach(message => {
      const progressBar = message.querySelector('.progress-bar');
      const closeButton = message.querySelector('.close-flash');
      
      // Animation de la barre de progression
      progressBar.style.transition = `width ${displayDuration}ms linear`;
      
      setTimeout(() => {
        progressBar.style.width = '0%';
      }, 100);
      
      // Fermeture automatique après le délai
      const autoCloseTimeout = setTimeout(() => {
        closeFlashMessage(message);
      }, displayDuration);
      
      // Gestionnaire d'événement pour le bouton de fermeture
      closeButton.addEventListener('click', () => {
        // Annuler le timeout de fermeture automatique
        clearTimeout(autoCloseTimeout);
        // Fermer le message immédiatement
        closeFlashMessage(message);
      });
    });
  });
</script>
